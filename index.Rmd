---
title: "Gov Final Project TBD"
author: "Dalton Raykowski"
description: "Milestone One"
output:
  distill::distill_article:
    self_contained: false
---

```{r Setup}
library(tidyverse)
library(broom)
library(infer)
```


## Introduction

  In this project I wish to explore the relationship between restrictions upon abortion with liberal policies. I wish to explore whether increasing contraceptive prevalence leads to an increase in availability to abortion. Within this I would be looking across sub-regions, rather than by continents or countries as I feel that would allow for a better view. To look at individual countries would introduce too many variables to plot, which would decrease legibility with little return. On the contrary, just looking at continents leads to the data being simplified to only seven groups which would cuase some points to be lost in the averages. The variable that I chose to use to represent the "liberal" policies is the prevalence of modern contraceptives. I chose this because based on the data that I found from the world bank, it was the one which I felt represented liberalism fairly well, and also had enough data to allow for a more complete analysis. 
  
## Loading In the Data

```{r}
library(tidyverse)
abortion<- read_csv("Data/Abortion_Laws_Indicators.csv")
world_bank <- read_csv("Data/91de8b42-fa3d-44cf-ab4e-4fac76ff364c_Data.csv")

regions = "https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv"

region_data<- read_csv(url(regions))

region_data <- region_data |>
  rename(ctr_name = name)

region_data

abortion
```

## Data Wrangling and Joining

```{r}
world_bank_change <- world_bank |>
  select(-c(`Series Code`,`Country Code`)) |>
  mutate("1960" = as.double(`1960 [YR1960]`),
         "1961" = as.double(`1961 [YR1961]`),
         "1962" = as.double(`1962 [YR1962]`),
         "1963" = as.double(`1963 [YR1963]`),
         "1964" = as.double(`1964 [YR1964]`),
         "1965" = as.double(`1965 [YR1965]`),
         "1966" = as.double(`1966 [YR1966]`),
         "1967" = as.double(`1967 [YR1967]`),
         "1968" = as.double(`1968 [YR1968]`),
         "1969" = as.double(`1969 [YR1969]`),
         "1970" = as.double(`1970 [YR1970]`),
         "1971" = as.double(`1971 [YR1971]`),
         "1972" = as.double(`1972 [YR1972]`),
         "1973" = as.double(`1973 [YR1973]`),
         "1974" = as.double(`1974 [YR1974]`),
         "1975" = as.double(`1975 [YR1975]`),
         "1976" = as.double(`1976 [YR1976]`),
         "1977" = as.double(`1977 [YR1977]`),
         "1978" = as.double(`1978 [YR1978]`),
         "1979" = as.double(`1979 [YR1979]`),
         "1980" = as.double(`1980 [YR1980]`),
         "1981" = as.double(`1981 [YR1981]`),
         "1982" = as.double(`1982 [YR1982]`),
         "1983" = as.double(`1983 [YR1983]`),
         "1984" = as.double(`1984 [YR1984]`),
         "1985" = as.double(`1985 [YR1985]`),
         "1986" = as.double(`1986 [YR1986]`),
         "1987" = as.double(`1987 [YR1987]`),
         "1988" = as.double(`1988 [YR1988]`),
         "1989" = as.double(`1989 [YR1989]`),
         "1990" = as.double(`1990 [YR1990]`),
         "1991" = as.double(`1991 [YR1991]`),
         "1992" = as.double(`1992 [YR1992]`),
         "1993" = as.double(`1993 [YR1993]`),
         "1994" = as.double(`1994 [YR1994]`),
         "1995" = as.double(`1995 [YR1995]`),
         "1996" = as.double(`1996 [YR1996]`),
         "1997" = as.double(`1997 [YR1997]`),
         "1998" = as.double(`1998 [YR1998]`),
         "1999" = as.double(`1999 [YR1999]`),
         "2000" = as.double(`2000 [YR2000]`)) |>
  select(-c(`1960 [YR1960]`:`2000 [YR2000]`)) |>
  pivot_longer(cols = -c(`Country Name`, `Series Name`),
               names_to = "year",
               values_to = "Values") |>
  mutate(row = row_number()) |>
  pivot_wider(names_from = "Series Name",
              values_from = "Values") |>
  select(-row) |>
  distinct() |>
  rename(ctr_name = `Country Name`) |>
  mutate(year = as.double(year))

world_bank_change


abort_stats <- abortion |>
  left_join(world_bank_change) |>
  select(-c(country, ctr_year))

abort_stats

abort_stats <- abort_stats |>
  left_join(region_data)

abort_stats <- abort_stats |>
  select(-c(`alpha-2`:`region`))

abort_stats <- abort_stats |>
  select(-index)

abort_stats_props <- abort_stats |>
  group_by(`sub-region`, year)|>
  summarise(life_threat = mean(life_threat, na.rm = T),
            physical_health = mean(physical_health, na.rm = T),
            mental_health = mean(mental_health, na.rm = T),
            rape = mean(rape, na.rm = T),
            fetal_impairment = mean(fetal_impairment, na.rm = T),
            request = mean(request, na.rm = T),
            `Contraceptive prevalence, any modern method (% of married women ages 15-49)` = mean(`Contraceptive prevalence, any modern method (% of married women ages 15-49)`, na.rm = T),) 

abort_stats_props
```
## Introducing the Data

  I sourced part of this data from a paper by David E. Bloom, David Canning, GuÌˆnther Fink, and Jocelyn E. Finlay titled "Fertility, female labor force participation, and the demographic dividend". The authors work with the Harvard School of Public Health, and published the data and paper in 2009. The data in this study could be seen as somewhat cross between cross-sectional and longitudinal studies. The world bank tracks the data from multiple countries over time, whereas the data from the paper appears to look at already recorded data across the categories. Because of this, the world bank could be seen as longitudinal, and the paper is cross-sectional.
  
  With the data in my table, thee columns ranging from life_threat to request are binary variables where a "1" means that an abortion would be available for the reason indicated; thus, if the USA had a "1" for request, then that would mean that abortion would be available on request. To these variables, I modified them such that they would provide a continuous scale to which change could be measured and plotted more meaningfully. Changing these involved grouping the categories down to the sub-regions and years and taking the average across the countries represented in those groups. 
  One example of how this looks for the request variable can be seen below: 
  
```{r}
abort_stats_props |>
  ggplot(aes(x = year, 
             y = request)) +
  geom_line() +
  facet_wrap(~`sub-region`, ncol = 4) +
  theme(axis.text = element_text(size = 8)) +
  labs(title = "Proportion of Places where Abortion is Available on Request Tracked by Years",
       x = "Year",
       y = "Proportion of Request")
```
  This plot demonstrates how the restrictions with regard to on request abortions change, and having it grouped to sub-regions allows for a clearer picture of what is going on. There is a higher likelihood of sub-regions representing similar views in comparison to continents where views can vary vastly. While this can still be seen across regions, there is a trade-off with ease of interpretation and accuracy of representation and by sub-region this is somewhat optimized.
  
  The data with modern contraceptives is sourced from the world bank website, and I have a plot of its trends following: 

```{r}
abort_stats |>
  drop_na(`Contraceptive prevalence, any modern method (% of married women ages 15-49)`) |>
  select(`sub-region`, year, ctr_name, `Contraceptive prevalence, any modern method (% of married women ages 15-49)`)|>
  group_by(`sub-region`) |>
  ggplot(mapping = aes(x = year, 
                       y = `Contraceptive prevalence, any modern method (% of married women ages 15-49)`)) + 
  geom_line(mapping = aes(group = ctr_name)) +
  geom_smooth(method = "lm",
              se = T) +
  facet_wrap(~ `sub-region`, ncol = 4) +
  labs(title = "Prevalence of Modern Contraceptives with Respect to Time, by Sub-Region",
       x = "Year",
       y = "Modern Contraceptive Prevalence (by % Married Women ages 15-49)") +
  theme(axis.text = element_text(size = 6),
        axis.title.y = element_text(size = 10))
```
  Within this plot I maintained lines which demonstrated each individual country's trend, as well as grouping by the sub-regions. In this it is relatively clear what is happening on an individual level as well as what is happening within the groups. This demonstrates a general upward trend, with a few deviations from that. 

## Subsetting for Some Regressions
```{r}
w_europe <- abort_stats_props |>
  filter(`sub-region` == "Western Europe")

n_africa <- abort_stats_props |>
  filter(`sub-region` == "Northern Africa")

e_asia <- abort_stats_props |>
  filter(`sub-region` == "Eastern Asia")


```

## A Look Into a Few Regressions
```{r}
mult_reg_request <- lm(request ~ year + `Contraceptive prevalence, any modern method (% of married women ages 15-49)` + life_threat + `sub-region`, data = abort_stats_props)

models <- list(
  "Bivar. Reg" = lm(request ~ `Contraceptive prevalence, any modern method (% of married women ages 15-49)`, data = abort_stats_props),
  "Reg. with Life Threat" = lm(request ~ `Contraceptive prevalence, any modern method (% of married women ages 15-49)`+ life_threat, data = abort_stats_props),
  "Reg. with Fetal Impairment" = lm(request ~ `Contraceptive prevalence, any modern method (% of married women ages 15-49)`+ fetal_impairment, data = abort_stats_props),
  "Mult. Reg" = lm(request ~ year + `Contraceptive prevalence, any modern method (% of married women ages 15-49)` + fetal_impairment + `sub-region`, data = abort_stats_props),
  "Western Europe" = lm(request ~ `Contraceptive prevalence, any modern method (% of married women ages 15-49)` + year + fetal_impairment, data = w_europe),
  "Northern Africa" = lm(request ~ `Contraceptive prevalence, any modern method (% of married women ages 15-49)` + year + fetal_impairment, data = n_africa),
  "Eastern Asia" = lm(request ~ `Contraceptive prevalence, any modern method (% of married women ages 15-49)` + year + fetal_impairment, data = e_asia))

modelsummary::modelsummary(models,
                           statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"),
                           gof_map = c("nobs", "r.squared", "adj.r.squared"))
```
## A look at Correlation
```{r}
corr <- abort_stats_props |>
  drop_na(request, fetal_impairment, life_threat)
fetal_cor <-cor(corr$request, corr$fetal_impairment)

fetal_cor

life_cor <- cor(corr$request, corr$life_threat)

life_cor
```

  Initially in the regressions I debated using the life_threat variable as a control of sorts to attempt to make the model fit better, however, based on the adjusted r squared, the different was only around 0.05. When I used the fetal_impairment variable, however, there was a much better fit demonstrated by the increase in around 0.6 for the adj. r squared. I then ran correlations between the request variable and these other two, and that demonstrated that the fetal_impairment variable is much closer correlated to request. This could be a reason that it led the variable to produce a better fit in the regression; therefore, I used this for the rest of the regressions.
  
  I then did a regression that included the sub-region variable which allowed for location to be factored in with the fit of the model, which further increased the fit. The final three are subsetted to specific locations and then the regression is performed within that data, which demonstrated that the model did fit in that data set. An interesting thing is that the final two variables had an adj. r squared of one. This would suggest that the regression fits nearly perfectly to the data which is an interesting thing to see. 
  
  Onto the main regression of interest, which is the "Reg. with Fetal Impairment." In this regression the intercept of it is -0.126, which suggests that when the independent variables (Contraceptive Prevalence, Fetal Impairment, etc.) are zero, that the request proportion would be -0.126. This does not hold much vallue as the proportion could logically not equal zero, but it gives a starting point for the proportion to grow. With the Contraceptive variable, the data suggests that when the other variables are held constant, the request proportion would increase by 0.0009 for every one percent increase in the contraceptive prevalence. This value has a p value of 0.043, so it is significant, yet this does not show a causal relationship as the across the regressions it does not result in a large change, and also the magnitude of the change is not large enough to explain the changes in the data. Fetal impairment demonstrates a stronger relationship as it shows that when fetal impairment proportion increases by one, the request proportion would increase by around 0.961. This also demonstrates significance as the p value is <0.001, which means that the likelihood of this value occurring by chance alone is very low. 
  
  Below I will plot the bivariate regression as it demonstrates the relationship with contraceptives and request. I will also demonstrate the relationship with fetal impairment and request:
  
## Contraceptive and Request  
```{r}
abort_stats_props |>
  ggplot(aes(x = `Contraceptive prevalence, any modern method (% of married women ages 15-49)`,
             y = request)) + 
  geom_point() +
  labs(y = "Request Proportion",
       title = "Relationship Between Request Proportion and Contraceptive Prevalence") +
  geom_smooth(method = "lm")
```

## Request and Fetal Impairment
```{r}
abort_stats_props |>
  ggplot(aes(x = fetal_impairment,
             y = request)) + 
  geom_point() +
  labs(y = "Request Proportion",
       x = "Fetal Impairment Proportion",
       title = "Relationship Between Request Proportion and Fetal Impairment Proportion") +
  geom_smooth(method = "lm")
```
These two plots demonstrate further that the contraceptive prevalence does not lead to a strong causal relationship as the data is quite scattered. Furthermore, the error can be seen to be larger in that graph suggesting that the relationship is not one that can be viewed causally. 

## Conclusion

  In this I was able to see that the my question of whether the contraceptive prevalence is tied to abortion access was true. Specifically, I found that in the case of abortions being available at request, the two are not closely related. The regression relating them demonstrates that an increase in the contraceptive prevalence does not lead to a strong increase in request availability, and in certain regions it actually led to a small decrease.  The main information here is that the two are not intrinsically related. 
  
  A limitation of this was the data I was using to measure the "liberal" policies. Within the constrains of this variable it was hard to determine whether the policies had an effect. This only had one policy to compare to, so that limits the scope of the analysis. Furthermore, the world bank data was extremely limited because many variables had a lot of NA data which makes it hard to use different ideal variables. To improve this in the future I would try to use a different source for the variables for the liberal policies such that I would have more plentiful data to analyse. 
  